"use strict";(()=>{var e={};e.id=426,e.ids=[426,660],e.modules={5135:(e,t,s)=>{s.r(t),s.d(t,{config:()=>v,default:()=>m,getServerSideProps:()=>g,getStaticPaths:()=>p,getStaticProps:()=>h,reportWebVitals:()=>f,routeModule:()=>y,unstable_getServerProps:()=>S,unstable_getServerSideProps:()=>P,unstable_getStaticParams:()=>_,unstable_getStaticPaths:()=>b,unstable_getStaticProps:()=>j});var a={};s.r(a),s.d(a,{default:()=>AdminOrders});var r=s(7093),i=s(5244),n=s(1323),l=s(9209),d=s.n(l),c=s(5913),o=s(997),x=s(6689),u=s(8755);function AdminOrders(){let[e,t]=(0,x.useState)([]),[s,a]=(0,x.useState)([]),[r,i]=(0,x.useState)(!0),[n,l]=(0,x.useState)({});async function fetchOrders(){i(!0);let e=await fetch("/api/orders",{cache:"no-store"});e.ok?t(await e.json()):console.error("Failed to load orders",await e.text()),i(!1)}async function fetchDeliveryPartners(){let e=await fetch("/api/delivery",{cache:"no-store"});e.ok?a(await e.json()):console.error("Failed to load delivery partners",await e.text())}async function assignToPartner(s,a){l(e=>({...e,[s]:!0})),t(e=>e.map(e=>e._id===s?{...e,assignedTo:a,status:a?"assigned":e.status}:e));try{let e=await fetch("/api/orders",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:s,action:"assign",assignedTo:a})});if(!e.ok){let t=await e.text();throw Error(t||"Failed to assign")}let r=await e.json();t(e=>e.map(e=>e._id===s?r:e))}catch(s){t(e),alert("Assign failed: "+(s?.message||"unknown"))}finally{l(e=>({...e,[s]:!1}))}}return(0,x.useEffect)(()=>{fetchOrders(),fetchDeliveryPartners();let e=setInterval(fetchOrders,1e4);return()=>clearInterval(e)},[]),(0,o.jsxs)(u.Z,{title:"Admin • Orders",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[o.jsx("h2",{className:"text-lg font-semibold",children:"Orders"}),o.jsx("div",{children:o.jsx("button",{onClick:fetchOrders,className:"px-3 py-1 bg-indigo-600 text-white rounded",children:"Refresh"})})]}),(0,o.jsxs)("div",{className:"mt-4",children:[r&&o.jsx("div",{className:"text-center py-6",children:"Loading…"}),!r&&0===e.length&&o.jsx("div",{className:"text-center text-gray-500",children:"No orders"}),!r&&e.map(e=>o.jsx("div",{className:"bg-white p-3 rounded shadow mb-3",children:(0,o.jsxs)("div",{className:"flex flex-col md:flex-row md:justify-between",children:[(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"font-medium",children:[e.customerName," ",(0,o.jsxs)("span",{className:"text-xs text-gray-500",children:["(",e.phone,")"]})]}),o.jsx("div",{className:"text-xs text-gray-500",children:e.address}),(0,o.jsxs)("div",{className:"text-xs mt-2",children:["Items: ",e.items?.join(", ")]}),(0,o.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:["Order ID: ",e._id]})]}),(0,o.jsxs)("div",{className:"mt-3 md:mt-0 flex items-center gap-3",children:[(0,o.jsxs)("div",{className:"text-sm",children:[o.jsx("div",{className:"text-xs text-gray-500",children:"Status"}),o.jsx("div",{className:"font-semibold",children:e.status})]}),(0,o.jsxs)("div",{children:[o.jsx("label",{className:"text-xs text-gray-500 block mb-1",children:"Assign to"}),(0,o.jsxs)("select",{value:e.assignedTo??"",onChange:t=>{let s=t.target.value||null;assignToPartner(e._id,s)},disabled:n[e._id],className:"border px-2 py-1 rounded",children:[o.jsx("option",{value:"",children:"— Unassigned —"}),s.map(e=>(0,o.jsxs)("option",{value:e._id,children:[e.name," ",e.vehicle?`(${e.vehicle})`:""]},e._id))]})]})]})]})},e._id))]})]})}let m=(0,n.l)(a,"default"),h=(0,n.l)(a,"getStaticProps"),p=(0,n.l)(a,"getStaticPaths"),g=(0,n.l)(a,"getServerSideProps"),v=(0,n.l)(a,"config"),f=(0,n.l)(a,"reportWebVitals"),j=(0,n.l)(a,"unstable_getStaticProps"),b=(0,n.l)(a,"unstable_getStaticPaths"),_=(0,n.l)(a,"unstable_getStaticParams"),S=(0,n.l)(a,"unstable_getServerProps"),P=(0,n.l)(a,"unstable_getServerSideProps"),y=new r.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/admin/orders",pathname:"/admin/orders",bundlePath:"",filename:""},components:{App:c.default,Document:d()},userland:a})},1649:e=>{e.exports=require("next-auth/react")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},1017:e=>{e.exports=require("path")},7310:e=>{e.exports=require("url")}};var t=require("../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[209,450,609,792,588,664,201,763,688],()=>__webpack_exec__(5135));module.exports=s})();