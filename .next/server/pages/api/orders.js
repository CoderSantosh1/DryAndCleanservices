"use strict";(()=>{var e={};e.id=722,e.ids=[722],e.modules={1185:e=>{e.exports=require("mongoose")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5920:(e,r,t)=>{t.r(r),t.d(r,{config:()=>m,default:()=>p,routeModule:()=>f});var n={};t.r(n),t.d(n,{default:()=>handler});var s=t(1802),a=t(7153),o=t(6249),d=t(1107),i=t(1185),l=t.n(i);let u=new i.Schema({customerName:{type:String},phone:{type:String},address:{type:String},cleanerId:{type:String,default:null},status:{type:String,enum:["created","assigned","picked","in_transit","completed","cancelled"],default:"created"},assignedTo:{type:String,default:null},items:{type:[String],default:[]}},{timestamps:!0}),c=l().models.Order||l().model("Order",u);async function handler(e,r){await (0,d.Z)();let t=e.method;try{if("GET"===t){let e=await c.find().sort({createdAt:-1});return r.status(200).json(e)}if("POST"===t){let t=e.body;if(!t.customerName||!t.phone||!t.address)return r.status(400).json({error:"customerName, phone and address are required"});let n=await c.create({customerName:t.customerName,phone:t.phone,address:t.address,cleanerId:t.cleanerId??null,items:t.items??[]});return r.status(201).json(n)}if("PATCH"===t){let{id:t,action:n,assignedTo:s,status:a}=e.body;if(!t)return r.status(400).json({error:"Order id is required for PATCH"});let o=await c.findById(t);if(!o)return r.status(404).json({error:"Order not found"});if("assign"===n)o.assignedTo=s??null,s&&(o.status="assigned");else{if("status"!==n||!a)return r.status(400).json({error:"Invalid action for PATCH"});if(!["created","assigned","picked","in_transit","completed","cancelled"].includes(a))return r.status(400).json({error:"Invalid status value"});o.status=a}return await o.save(),r.status(200).json(o)}return r.setHeader("Allow",["GET","POST","PATCH"]),r.status(405).end(`Method ${t} Not Allowed`)}catch(e){return console.error("orders api error:",e),r.status(500).json({error:e.message||"Server error"})}}let p=(0,o.l)(n,"default"),m=(0,o.l)(n,"config"),f=new s.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/orders",pathname:"/api/orders",bundlePath:"",filename:""},userland:n})},1107:(e,r,t)=>{t.d(r,{Z:()=>connectDB});var n=t(1185),s=t.n(n);let a=process.env.MONGODB_URI;if(!a)throw Error("❌ Please add MONGODB_URI in .env.local file");let o=global.mongoose;async function connectDB(){return o.conn||(o.promise||(o.promise=s().connect(a).then(e=>(console.log("✅ MongoDB connected"),e))),o.conn=await o.promise),o.conn}o||(o=global.mongoose={conn:null,promise:null})}};var r=require("../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[222],()=>__webpack_exec__(5920));module.exports=t})();