"use strict";(()=>{var e={};e.id=717,e.ids=[717],e.modules={1185:e=>{e.exports=require("mongoose")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7207:(e,r,t)=>{t.r(r),t.d(r,{config:()=>u,default:()=>l,routeModule:()=>p});var n={};t.r(n),t.d(n,{default:()=>handler});var a=t(1802),i=t(7153),o=t(6249),s=t(1107),d=t(2964);async function handler(e,r){if(await (0,s.Z)(),"POST"!==e.method)return r.setHeader("Allow",["POST"]),r.status(405).end("Method not allowed");try{let{phone:t,createIfNotFound:n=!1}=e.body;if(!t)return r.status(400).json({error:"phone is required"});let a=t.trim(),i=await d.Z.findOne({phone:a});if(!i&&n&&(i=await d.Z.create({name:`Delivery ${a.slice(-4)}`,phone:a,vehicle:"Unknown",active:!0})),!i)return r.status(404).json({error:"No delivery partner found with this number"});return r.status(200).json({id:i._id,name:i.name,phone:i.phone})}catch(e){return console.error("delivery login error",e),r.status(500).json({error:e.message||"Server error"})}}let l=(0,o.l)(n,"default"),u=(0,o.l)(n,"config"),p=new a.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/delivery/login",pathname:"/api/delivery/login",bundlePath:"",filename:""},userland:n})}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[222,651],()=>__webpack_exec__(7207));module.exports=t})();