(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[748],{7458:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/delivery/orders",function(){return s(1652)}])},9595:function(e,t){"use strict";t.Z={src:"/_next/static/media/tide.f7ee2ce8.png",height:225,width:225,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAWlBMVEX///////7///3+//////z///v///r//v7+/v/+/v7+/f39/f79/Pz8/P35+vz4+Pr18e7/7Nzr6ODe4Onh3uPb3Ofh2t/g09XD2t/a08XT0NjR0NnQzNaz1uFXaTgPAAAAPklEQVR42hXHxxGAMBAEwYETcIv3XvmnqVL/GiGgMBDqO29wEe85l3J9FloYtvM6RkD7+/0TiFBXAYHMzEUCTRUCNAkNPUEAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8}},8755:function(e,t,s){"use strict";s.d(t,{Z:function(){return Layout}});var i=s(5893),r=s(7294),a=s(1664),n=s.n(a),l=s(1352),d=s(7232),o=s(5675),c=s.n(o),u=s(9595);function Header(e){let{title:t="Tidee Services"}=e,[s,a]=(0,r.useState)(!1);return(0,i.jsxs)("header",{className:"bg-white border-b shadow-sm sticky top-0 z-50",children:[(0,i.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-3 flex items-center justify-between",children:[(0,i.jsx)("div",{className:"flex items-center gap-2",children:(0,i.jsxs)(n(),{href:"/",className:"flex items-center gap-2",children:[(0,i.jsx)(c(),{src:u.Z,alt:"Tidee Services Logo",className:"w-8 h-8 rounded-full"}),(0,i.jsx)("span",{className:"text-lg font-semibold text-indigo-700 tracking-wide",children:"Tidee Services Noida"})]})}),(0,i.jsxs)("nav",{className:"hidden md:flex items-center gap-6 text-sm font-medium",children:[(0,i.jsx)(n(),{href:"/",className:"text-gray-700 hover:text-indigo-600",children:"Home"}),(0,i.jsx)(n(),{href:"/services",className:"text-gray-700 hover:text-indigo-600",children:"Services"}),(0,i.jsx)(n(),{href:"/about",className:"text-gray-700 hover:text-indigo-600",children:"About"}),(0,i.jsx)(n(),{href:"/contact",className:"text-gray-700 hover:text-indigo-600",children:"Contact"}),(0,i.jsx)(n(),{href:"/delivery",className:"text-indigo-600 border border-indigo-600 px-3 py-1.5 rounded-md hover:bg-indigo-600 hover:text-white transition",children:"Delevery"})]}),(0,i.jsx)("button",{onClick:()=>a(!s),className:"md:hidden p-2 rounded-lg hover:bg-gray-100 transition","aria-label":"Toggle menu",children:s?(0,i.jsx)(l.Z,{size:22}):(0,i.jsx)(d.Z,{size:22})})]}),s&&(0,i.jsx)("div",{className:"md:hidden border-t bg-white",children:(0,i.jsxs)("nav",{className:"flex flex-col space-y-2 p-4 text-sm",children:[(0,i.jsx)(n(),{href:"/",className:"block py-2 text-gray-700 hover:text-indigo-600",onClick:()=>a(!1),children:"Home"}),(0,i.jsx)(n(),{href:"/services",className:"block py-2 text-gray-700 hover:text-indigo-600",onClick:()=>a(!1),children:"Services"}),(0,i.jsx)(n(),{href:"/pricing",className:"block py-2 text-gray-700 hover:text-indigo-600",onClick:()=>a(!1),children:"Pricing"}),(0,i.jsx)(n(),{href:"/about",className:"block py-2 text-gray-700 hover:text-indigo-600",onClick:()=>a(!1),children:"About"}),(0,i.jsx)(n(),{href:"/contact",className:"block py-2 text-gray-700 hover:text-indigo-600",onClick:()=>a(!1),children:"Contact"})]})})]})}function Layout(e){let{children:t,title:s}=e;return(0,i.jsxs)("div",{className:"",children:[(0,i.jsx)(Header,{title:s}),(0,i.jsx)("main",{children:t})]})}},1652:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return DeliveryOrders}});var i=s(5893),r=s(7294),a=s(8755),n=s(1163);function DeliveryPhoneLogin(e){let{createIfNotFound:t=!1}=e,[s,a]=(0,r.useState)(""),[l,d]=(0,r.useState)(!1),[o,c]=(0,r.useState)(null),u=(0,n.useRouter)();async function handleSubmit(e){if(e.preventDefault(),c(null),!s||s.trim().length<6){c("Please enter a valid mobile number");return}d(!0);try{let e=await fetch("/api/delivery/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:s.trim(),createIfNotFound:t})}),i=await e.text();console.log("[delivery login] status:",e.status,"body:",i);let r=null;try{r=JSON.parse(i)}catch(e){r=i}if(!e.ok){let e=r&&r.error?r.error:"Login failed";c(e),d(!1);return}let a=r.id,n=r.name||r.phone||"Delivery",l=r.phone||s.trim();localStorage.setItem("delivery_user",JSON.stringify({id:a,name:n,phone:l})),window.dispatchEvent(new Event("delivery-login")),await u.replace("/delivery/orders"),window.location.reload()}catch(e){console.error("Login error",e),c((null==e?void 0:e.message)||"Network error")}finally{d(!1)}}return(0,i.jsxs)("form",{onSubmit:handleSubmit,className:"max-w-sm mx-auto bg-white p-4 rounded shadow",children:[(0,i.jsx)("h3",{className:"font-semibold mb-3",children:"Delivery partner login (mobile)"}),(0,i.jsx)("label",{className:"text-xs text-gray-600 block mb-1",children:"Mobile number"}),(0,i.jsx)("input",{value:s,onChange:e=>a(e.target.value),placeholder:"e.g. 9876543210",className:"w-full border px-3 py-2 rounded mb-2",inputMode:"numeric"}),o&&(0,i.jsx)("div",{className:"text-sm text-red-600 mb-2",children:o}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("button",{type:"submit",disabled:l,className:"px-4 py-2 bg-indigo-600 text-white rounded",children:l?"Signing in…":"Sign in"}),(0,i.jsx)("button",{type:"button",onClick:()=>{a(""),c(null)},className:"px-3 py-2 border rounded",children:"Clear"})]}),(0,i.jsx)("p",{className:"mt-3 text-xs text-gray-500",children:"This is a quick login for testing. Use proper auth in production."})]})}var l=s(3299);function DeliveryOrders(){var e;let{data:t,status:s}=(0,l.useSession)(),[n,d]=(0,r.useState)(null),[o,c]=(0,r.useState)([]),[u,x]=(0,r.useState)(!1),[h,m]=(0,r.useState)({});(0,r.useEffect)(()=>{try{let e=localStorage.getItem("delivery_user");if(e){let t=JSON.parse(e);(null==t?void 0:t.id)&&d(t.id)}}catch(e){}},[]);let g=(0,r.useMemo)(()=>{var e;let s=t&&(null===(e=t.user)||void 0===e?void 0:e.id)||null;return null!=s?s:n},[t,n]);async function fetchOrdersForDelivery(e){x(!0);try{let t=await fetch("/api/orders",{cache:"no-store"});if(!t.ok){console.error("Failed to fetch orders",await t.text()),c([]);return}let s=await t.json(),i=s.filter(t=>t.assignedTo===e);c(i)}catch(e){console.error("Error fetching orders",e),c([])}finally{x(!1)}}async function updateStatus(e,t){m(t=>({...t,[e]:!0}));try{let s=await fetch("/api/orders",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,action:"status",status:t})});if(!s.ok){let e=await s.text();throw Error(e||"Failed to update status")}let i=await s.json();c(t=>t.map(t=>t._id===e?i:t))}catch(e){console.error("Update failed:",e),alert("Failed to update status: "+((null==e?void 0:e.message)||""))}finally{m(t=>({...t,[e]:!1}))}}return((0,r.useEffect)(()=>{if(!g)return;fetchOrdersForDelivery(g);let e=setInterval(()=>fetchOrdersForDelivery(g),8e3);return()=>clearInterval(e)},[g]),"loading"===s)?(0,i.jsx)(a.Z,{title:"Delivery • Loading",children:(0,i.jsx)("div",{className:"py-12 text-center",children:"Loading session…"})}):g?(0,i.jsxs)(a.Z,{title:"Delivery • Orders",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold",children:"My Assigned Orders"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("button",{onClick:()=>fetchOrdersForDelivery(g),className:"px-3 py-1 bg-indigo-600 text-white rounded",children:"Refresh"}),(0,i.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Signed in as"," ",(0,i.jsx)("strong",{children:t&&(null===(e=t.user)||void 0===e?void 0:e.name)||(localStorage.getItem("delivery_user")?JSON.parse(localStorage.getItem("delivery_user")).name:"Delivery")})]})]})]}),u&&(0,i.jsx)("div",{className:"text-center py-6",children:"Loading…"}),!u&&0===o.length&&(0,i.jsx)("div",{className:"text-center text-gray-500",children:"No assigned orders"}),(0,i.jsx)("div",{className:"space-y-3",children:o.map(e=>(0,i.jsxs)("div",{className:"bg-white p-3 rounded shadow mb-3",children:[(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium",children:e.customerName}),(0,i.jsx)("div",{className:"text-xs text-gray-500",children:e.address})]}),(0,i.jsxs)("div",{className:"text-right",children:[(0,i.jsx)("div",{className:"text-sm",children:e.status}),(0,i.jsx)("div",{className:"text-xs",children:new Date(e.createdAt).toLocaleString()})]})]}),(0,i.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,i.jsx)("button",{onClick:()=>updateStatus(e._id,"picked"),disabled:h[e._id]||"picked"===e.status||"completed"===e.status,className:"px-2 py-1 rounded border disabled:opacity-50",children:"Picked"}),(0,i.jsx)("button",{onClick:()=>updateStatus(e._id,"in_transit"),disabled:h[e._id]||"in_transit"===e.status||"completed"===e.status,className:"px-2 py-1 rounded border disabled:opacity-50",children:"In Transit"}),(0,i.jsx)("button",{onClick:()=>updateStatus(e._id,"completed"),disabled:h[e._id]||"completed"===e.status,className:"px-2 py-1 rounded border bg-green-50 disabled:opacity-50",children:"Complete"})]})]},e._id))})]}):(0,i.jsx)(a.Z,{title:"Delivery • Sign in",children:(0,i.jsxs)("div",{className:"py-8 max-w-lg mx-auto space-y-6",children:[(0,i.jsx)("p",{className:"text-center",children:"Sign in with mobile number to view your assigned orders."}),(0,i.jsx)(DeliveryPhoneLogin,{createIfNotFound:!0}),(0,i.jsxs)("div",{className:"text-center text-sm text-gray-500",children:["or"," ",(0,i.jsx)("button",{onClick:()=>(0,l.signIn)(),className:"text-indigo-600 underline",children:"sign in with account"})]})]})})}},1163:function(e,t,s){e.exports=s(9974)}},function(e){e.O(0,[664,763,774,888,179],function(){return e(e.s=7458)}),_N_E=e.O()}]);